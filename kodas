#include "mylib.h"

int main()
{
    vector<Studentas> Grupe;
    string pas; // naudotojo pasirinkimas.
    cout << "Ar noretumete studentus irasyti pats ar nuskaityti is failo (p arba f)?" << endl;
    cin >> pas;

    if (pas == "p")
    {
        cout << "Kiek studentu yra grupeje? ";
        int n;
        cin >> n;
        for (auto z = 0; z < n; z++)
        {
            Grupe.push_back(Stud_iv());
        }
    }
    int sk;
    if (pas == "f")
    {

        cout << "Sugeneruosime 5 skirtingo dydzio failus. " << endl;
        cout << "Kiek pazymiu generuojam kiekvienam studentui? ";
        cin >> sk;
        cout << "Generuojami failai..." << endl;
        failu_generavimas(10000, sk);
        failu_generavimas(100000, sk);
        failu_generavimas(1000000, sk);
        failu_generavimas(10000000, sk);
        stringstream buffer = bufer_nusk("studentai10000.txt");
        string eil;
        getline(buffer, eil);
        while (getline(buffer, eil))
        {
            Studentas stud;
            int paz, suma = 0;
            istringstream iss(eil); // paverčiame eilutę į objektą.
            iss >> stud.var >> stud.pav;
            while (iss >> paz)
            {
                stud.paz.push_back(paz);
                suma += paz;
            }
            suma -= paz;
            stud.egz = stud.paz.back();
            stud.paz.pop_back();
            stud.gal = double(suma) / double(stud.paz.size()) * 0.4 + 0.6 * stud.egz;
            stud.med = double(Mediana(stud)) * 0.4 + 0.6 * stud.egz;
            Grupe.push_back(stud);
        }
    }

    vector<Studentas> moksliukai;
    vector<Studentas> nemoksos;
    for (auto &stud : Grupe)
    {
        if (islaike(stud))
        {
            moksliukai.push_back(stud);
        }
        else
        {
            nemoksos.push_back(stud);
        }
    }
    string pasirinkimas;

    // sort(Grupe.begin(), Grupe.end(), rusiavimas);

    ofstream outm("moksliukai.txt");
    ofstream outn("nemoksos.txt");
    cout << "Ar noretumete gauti tik vidurki (V), tik mediana (M) ar abu (A)? ";
    cin >> pasirinkimas;
    outn << setw(16) << left << "Pavarde " << setw(10) << left << "Vardas ";
    outm << setw(16) << left << "Pavarde " << setw(10) << left << "Vardas ";
    if (pasirinkimas == "V"){ outm << "Gal."<<endl; outn << "Gal."<<endl;}
    if (pasirinkimas == "M"){ outm << "Med."<<endl;  outn << "Med."<<endl;}
    if (pasirinkimas == "A"){ outm << setw(10) << "Gal. "<< setw(10) << " Med."<<endl; outn << setw(10) << "Gal. "<< setw(10) << " Med."<<endl;}

    for (auto &stud : moksliukai)
    {
        spausdink_studenta(outm, stud, pasirinkimas);
    }

    for (auto &stud : nemoksos)
    {
        spausdink_studenta(outn, stud, pasirinkimas);
    }
    outm.close();
    outn.close();
}
